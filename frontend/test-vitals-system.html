<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Vitals Logging System - Test Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/chart.js"></script>
    <style>
        .vitals-container {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        .category-normal { background-color: #dcfce7; color: #15803d; border-color: #bbf7d0; }
        .category-warning { background-color: #fef3c7; color: #d97706; border-color: #fde68a; }
        .category-alert { background-color: #fed7d7; color: #dc2626; border-color: #fecaca; }
        .category-danger { background-color: #fee2e2; color: #dc2626; border-color: #fecaca; }
        .category-emergency { background-color: #fce8e6; color: #991b1b; border-color: #f87171; }
    </style>
</head>
<body class="bg-gray-100 vitals-container">
    <div class="container mx-auto py-8 px-4">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-4">üè• Daily Vitals Logging System</h1>
            <p class="text-xl text-gray-600">Comprehensive Health Monitoring with AI Analysis</p>
            <p class="text-sm text-gray-500 mt-2">Enter your daily vitals and get instant feedback with personalized suggestions</p>
        </div>

        <!-- Server Status -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-semibold mb-4">System Status</h2>
            <div id="server-status" class="mb-4">
                <p class="text-gray-600">Checking server connection...</p>
            </div>
        </div>

        <!-- Vitals Input Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Blood Pressure -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <span class="text-red-500 mr-2">‚ù§Ô∏è</span>
                    Blood Pressure
                </h3>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Systolic (mmHg)</label>
                        <input type="number" id="systolic" class="w-full border border-gray-300 rounded-md px-3 py-2" placeholder="120">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Diastolic (mmHg)</label>
                        <input type="number" id="diastolic" class="w-full border border-gray-300 rounded-md px-3 py-2" placeholder="80">
                    </div>
                </div>
                <button onclick="analyzeBP()" class="w-full bg-red-500 hover:bg-red-600 text-white rounded-lg px-4 py-2 font-medium">
                    Analyze Blood Pressure
                </button>
                <div id="bp-analysis" class="mt-4"></div>
            </div>

            <!-- Blood Sugar -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <span class="text-blue-500 mr-2">ü©∏</span>
                    Blood Sugar
                </h3>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Blood Sugar (mg/dL)</label>
                    <input type="number" id="bloodsugar" class="w-full border border-gray-300 rounded-md px-3 py-2" placeholder="100">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Test Type</label>
                    <select id="sugartype" class="w-full border border-gray-300 rounded-md px-3 py-2">
                        <option value="fasting">Fasting</option>
                        <option value="post_meal">Post-Meal</option>
                    </select>
                </div>
                <button onclick="analyzeBloodSugar()" class="w-full bg-blue-500 hover:bg-blue-600 text-white rounded-lg px-4 py-2 font-medium">
                    Analyze Blood Sugar
                </button>
                <div id="bs-analysis" class="mt-4"></div>
            </div>

            <!-- Weight & BMI -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <span class="text-green-500 mr-2">‚öñÔ∏è</span>
                    Weight & BMI
                </h3>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Weight (kg)</label>
                        <input type="number" id="weight" class="w-full border border-gray-300 rounded-md px-3 py-2" placeholder="70">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Height (cm)</label>
                        <input type="number" id="height" class="w-full border border-gray-300 rounded-md px-3 py-2" placeholder="170">
                    </div>
                </div>
                <div id="bmi-display" class="text-sm text-gray-600 mb-4"></div>
                <button onclick="analyzeBMI()" class="w-full bg-green-500 hover:bg-green-600 text-white rounded-lg px-4 py-2 font-medium">
                    Analyze Weight & BMI
                </button>
                <div id="bmi-analysis" class="mt-4"></div>
            </div>

            <!-- Cholesterol -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <span class="text-purple-500 mr-2">üß™</span>
                    Cholesterol Panel
                </h3>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Total (mg/dL)</label>
                        <input type="number" id="total-chol" class="w-full border border-gray-300 rounded-md px-3 py-2" placeholder="200">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">LDL (mg/dL)</label>
                        <input type="number" id="ldl-chol" class="w-full border border-gray-300 rounded-md px-3 py-2" placeholder="100">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">HDL (mg/dL)</label>
                        <input type="number" id="hdl-chol" class="w-full border border-gray-300 rounded-md px-3 py-2" placeholder="50">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Triglycerides</label>
                        <input type="number" id="triglycerides" class="w-full border border-gray-300 rounded-md px-3 py-2" placeholder="150">
                    </div>
                </div>
                <button onclick="analyzeCholesterol()" class="w-full bg-purple-500 hover:bg-purple-600 text-white rounded-lg px-4 py-2 font-medium">
                    Analyze Cholesterol
                </button>
                <div id="chol-analysis" class="mt-4"></div>
            </div>
        </div>

        <!-- Comprehensive Analysis -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h3 class="text-xl font-semibold mb-4">Comprehensive Health Analysis</h3>
            <button onclick="analyzeAll()" class="bg-indigo-500 hover:bg-indigo-600 text-white rounded-lg px-6 py-3 font-medium">
                Analyze All Vitals
            </button>
            <div id="comprehensive-analysis" class="mt-4"></div>
        </div>

        <!-- Example Values Section -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-xl font-semibold mb-4">Quick Test Examples</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button onclick="loadNormalValues()" class="bg-green-500 hover:bg-green-600 text-white rounded-lg px-4 py-2 font-medium">
                    Load Normal Values
                </button>
                <button onclick="loadElevatedValues()" class="bg-yellow-500 hover:bg-yellow-600 text-white rounded-lg px-4 py-2 font-medium">
                    Load Elevated Values
                </button>
                <button onclick="loadHighRiskValues()" class="bg-red-500 hover:bg-red-600 text-white rounded-lg px-4 py-2 font-medium">
                    Load High Risk Values
                </button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api/vitals';

        // Check server status
        const checkServerStatus = async () => {
            const statusDiv = document.getElementById('server-status');
            try {
                const response = await fetch('http://localhost:5000/health', { timeout: 5000 });
                statusDiv.innerHTML = '<p class="text-green-600">‚úÖ Server is running and accessible</p>';
            } catch (error) {
                statusDiv.innerHTML = '<p class="text-red-600">‚ùå Server is not accessible. Please start the backend server.</p>';
            }
        };

        // Calculate BMI
        const calculateBMI = () => {
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);

            if (weight && height) {
                const bmi = (weight / ((height / 100) ** 2)).toFixed(1);
                document.getElementById('bmi-display').textContent = `Calculated BMI: ${bmi}`;
                return bmi;
            }
            return null;
        };

        // Update BMI display when values change
        document.getElementById('weight').addEventListener('input', calculateBMI);
        document.getElementById('height').addEventListener('input', calculateBMI);

        // Analysis functions
        const analyzeVital = async (vitalType, values) => {
            try {
                const response = await fetch(`${API_BASE}/test`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ vitalType, values })
                });

                const data = await response.json();
                return data.success ? data.data.analysis : null;
            } catch (error) {
                console.error('Analysis failed:', error);
                return null;
            }
        };

        const renderAnalysis = (analysis, containerId) => {
            const container = document.getElementById(containerId);

            if (!analysis) {
                container.innerHTML = '<p class="text-red-600">Analysis failed. Please check your input values.</p>';
                return;
            }

            const categoryClass = `category-${analysis.category || 'normal'}`;

            let html = `
                <div class="border-l-4 p-4 ${categoryClass} rounded-r-lg">
                    <h4 class="font-semibold">${analysis.feedback}</h4>
                    ${analysis.suggestions ? `
                        <div class="mt-2">
                            <p class="text-sm font-medium">Recommendations:</p>
                            <ul class="text-sm mt-1 space-y-1">
                                ${analysis.suggestions.slice(0, 3).map(suggestion => `<li>‚Ä¢ ${suggestion}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                </div>
            `;

            container.innerHTML = html;
        };

        const analyzeBP = async () => {
            const systolic = parseInt(document.getElementById('systolic').value);
            const diastolic = parseInt(document.getElementById('diastolic').value);

            if (!systolic || !diastolic) {
                alert('Please enter both systolic and diastolic values');
                return;
            }

            const analysis = await analyzeVital('blood_pressure', { systolic, diastolic });
            renderAnalysis(analysis, 'bp-analysis');
        };

        const analyzeBloodSugar = async () => {
            const value = parseInt(document.getElementById('bloodsugar').value);
            const type = document.getElementById('sugartype').value;

            if (!value) {
                alert('Please enter blood sugar value');
                return;
            }

            const analysis = await analyzeVital('blood_sugar', { value, type });
            renderAnalysis(analysis, 'bs-analysis');
        };

        const analyzeBMI = async () => {
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);

            if (!weight || !height) {
                alert('Please enter both weight and height');
                return;
            }

            const bmi = parseFloat(calculateBMI());
            const analysis = await analyzeVital('weight_bmi', { weight, height, bmi });
            renderAnalysis(analysis, 'bmi-analysis');
        };

        const analyzeCholesterol = async () => {
            const total = parseInt(document.getElementById('total-chol').value);
            const ldl = parseInt(document.getElementById('ldl-chol').value);
            const hdl = parseInt(document.getElementById('hdl-chol').value);
            const triglycerides = parseInt(document.getElementById('triglycerides').value);

            if (!total && !ldl && !hdl) {
                alert('Please enter at least one cholesterol value');
                return;
            }

            const analysis = await analyzeVital('cholesterol', { total, ldl, hdl, triglycerides });

            // Special handling for cholesterol panel
            const container = document.getElementById('chol-analysis');

            if (analysis && analysis.results) {
                let html = `<div class="space-y-2">`;

                analysis.results.forEach(result => {
                    const categoryClass = `category-${result.category || 'normal'}`;
                    html += `
                        <div class="border-l-4 p-3 ${categoryClass} rounded-r-lg">
                            <h5 class="font-medium">${result.cholesterolType.toUpperCase()}: ${result.value}</h5>
                            <p class="text-sm">${result.feedback}</p>
                        </div>
                    `;
                });

                html += `<div class="mt-3 p-3 bg-gray-100 rounded-lg">
                    <p class="font-medium">Overall Risk: ${analysis.overallRisk.replace('_', ' ').toUpperCase()}</p>
                </div></div>`;

                container.innerHTML = html;
            } else {
                renderAnalysis(analysis, 'chol-analysis');
            }
        };

        const analyzeAll = async () => {
            const results = [];

            // Analyze BP
            const systolic = parseInt(document.getElementById('systolic').value);
            const diastolic = parseInt(document.getElementById('diastolic').value);
            if (systolic && diastolic) {
                results.push({
                    type: 'Blood Pressure',
                    analysis: await analyzeVital('blood_pressure', { systolic, diastolic })
                });
            }

            // Analyze Blood Sugar
            const bloodsugar = parseInt(document.getElementById('bloodsugar').value);
            const sugartype = document.getElementById('sugartype').value;
            if (bloodsugar) {
                results.push({
                    type: 'Blood Sugar',
                    analysis: await analyzeVital('blood_sugar', { value: bloodsugar, type: sugartype })
                });
            }

            // Analyze BMI
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);
            if (weight && height) {
                const bmi = parseFloat(calculateBMI());
                results.push({
                    type: 'Weight & BMI',
                    analysis: await analyzeVital('weight_bmi', { weight, height, bmi })
                });
            }

            const container = document.getElementById('comprehensive-analysis');

            if (results.length === 0) {
                container.innerHTML = '<p class="text-gray-600">Please enter some vital signs to analyze.</p>';
                return;
            }

            let html = '<div class="space-y-4">';

            results.forEach(result => {
                if (result.analysis) {
                    const categoryClass = `category-${result.analysis.category || 'normal'}`;
                    html += `
                        <div class="border-l-4 p-4 ${categoryClass} rounded-r-lg">
                            <h4 class="font-semibold">${result.type}</h4>
                            <p class="text-sm mt-1">${result.analysis.feedback}</p>
                        </div>
                    `;
                }
            });

            html += '</div>';
            container.innerHTML = html;
        };

        // Load example values
        const loadNormalValues = () => {
            document.getElementById('systolic').value = 115;
            document.getElementById('diastolic').value = 75;
            document.getElementById('bloodsugar').value = 90;
            document.getElementById('weight').value = 70;
            document.getElementById('height').value = 170;
            document.getElementById('total-chol').value = 180;
            document.getElementById('ldl-chol').value = 90;
            document.getElementById('hdl-chol').value = 55;
            calculateBMI();
        };

        const loadElevatedValues = () => {
            document.getElementById('systolic').value = 125;
            document.getElementById('diastolic').value = 78;
            document.getElementById('bloodsugar').value = 110;
            document.getElementById('weight').value = 85;
            document.getElementById('height').value = 170;
            document.getElementById('total-chol').value = 220;
            document.getElementById('ldl-chol').value = 140;
            document.getElementById('hdl-chol').value = 40;
            calculateBMI();
        };

        const loadHighRiskValues = () => {
            document.getElementById('systolic').value = 155;
            document.getElementById('diastolic').value = 95;
            document.getElementById('bloodsugar').value = 180;
            document.getElementById('weight').value = 95;
            document.getElementById('height').value = 170;
            document.getElementById('total-chol').value = 280;
            document.getElementById('ldl-chol').value = 180;
            document.getElementById('hdl-chol').value = 35;
            calculateBMI();
        };

        // Initialize
        checkServerStatus();
        calculateBMI();
    </script>
</body>
</html>